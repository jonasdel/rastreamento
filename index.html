<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ReciclaLogo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #2e7d32;
            --bg: #F5F5F5;
            --text: #333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: Roboto, Helvetica, Arial, sans-serif; }
        
        body { 
            background-color: #333; 
            display: flex; 
            justify-content: center; 
            height: 100vh; 
            overflow: hidden; 
        }

        #app-frame {
            width: 100%; 
            height: 100%;
            background-color: var(--bg);
            display: flex; 
            flex-direction: column;
            position: relative;
        }

        @media (min-width: 500px) {
            #app-frame { max-width: 412px; }
        }

        /* --- HEADER --- */
        header {
            background-color: var(--primary); 
            color: white; 
            height: 56px; 
            display: flex;
            align-items: center; 
            justify-content: center;
            flex-shrink: 0; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .header-title { font-size: 20px; font-weight: 600; }
        .back-btn { position: absolute; left: 16px; color: white; cursor: pointer; font-size: 20px; display: none; }

        /* --- MAIN --- */
        main { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            padding: 10px 12px; 
            overflow: hidden; 
            position: relative;
        }
        main.no-padding { padding: 0; }

        .screen { display: none; height: 100%; width: 100%; }
        .screen.active { display: flex; flex-direction: column; }

        .instruction-text {
            text-align: center; color: #666; font-size: 13px; margin-bottom: 8px; flex-shrink: 0;
        }

        /* --- GRID PERFEITO --- */
        .grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            grid-template-rows: repeat(4, 1fr); 
            gap: 10px; 
            flex: 1; 
            min-height: 0;
        }
        
        .card {
            border-radius: 12px;
            color: white;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            width: 100%; height: 100%; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            cursor: pointer; 
            position: relative;
        }
        .card:active { transform: scale(0.98); opacity: 0.9; }
        .card i { font-size: 36px; margin-bottom: 5px; }
        .card span { font-weight: bold; font-size: 14px; text-transform: uppercase; }

        /* CORES */
        .bg-blue { background-color: #1976D2; }
        .bg-red { background-color: #D32F2F; }
        .bg-yellow { background-color: #FBC02D; }
        .bg-green { background-color: #388E3C; }
        .bg-gray { background-color: #616161; }
        .bg-orange { background-color: #F57C00; }
        .bg-brown { background-color: #E64A19; }
        .bg-dark { background-color: #455A64; }

        /* --- ESTILOS ESPECÍFICOS DA TELA DE ROTAS (Restaurados) --- */
        .map-container {
            width: 100%; height: 100%; position: relative;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/OpenStreetMap_im_Dortmunder_Westen.png'); 
            background-size: cover; background-position: center;
        }
        
        /* Barra de Busca */
        .search-bar-container {
            position: absolute; top: 15px; left: 15px; right: 15px;
            background: white; border-radius: 4px; padding: 0 15px; height: 48px;
            display: flex; align-items: center; box-shadow: 0 2px 6px rgba(0,0,0,0.3); z-index: 2;
        }
        .search-bar-container input { border: none; outline: none; flex: 1; font-size: 16px; margin-left: 10px; }

        /* Botões Toggle (Rotas/Ecopontos) */
        .toggle-container {
            position: absolute; top: 75px; left: 15px; right: 15px;
            display: flex; gap: 10px; z-index: 2;
        }
        .toggle-btn {
            flex: 1; padding: 10px; border-radius: 25px; text-align: center;
            font-weight: bold; font-size: 13px; color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        .toggle-active { background-color: #1b5e20; }
        .toggle-inactive { background-color: #757575; }

        /* Pino do Mapa */
        .map-pin {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #F57C00; font-size: 45px; z-index: 1; text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* Cartão Inferior (Aviso) */
        .bottom-card-overlay {
            position: absolute; bottom: 20px; left: 15px; right: 15px;
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2); z-index: 2; text-align: center;
        }
        .bottom-card-text { font-size: 14px; color: #444; margin-bottom: 15px; line-height: 1.4; }
        .bottom-card-btn {
            background-color: #1b5e20; color: white; text-align: center;
            padding: 12px; border-radius: 25px; font-weight: bold; font-size: 14px;
            text-transform: uppercase; width: 100%; border: none; cursor: pointer;
        }

        /* OUTRAS TELAS */
        .scrollable-content { overflow-y: auto; flex: 1; padding: 5px; }
        .btn-action {
            background-color: var(--primary); color: white; border: none; padding: 15px;
            border-radius: 8px; font-size: 16px; margin-top: auto; width: 100%;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold;
        }
        .form-input { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
        
        /* NAV BAR */
        nav.bottom-nav {
            background: white; border-top: 1px solid #ddd; display: flex; justify-content: space-around; 
            height: 60px; flex-shrink: 0; z-index: 10; align-items: center;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #757575; font-size: 10px; cursor: pointer; width: 25%; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 24px; margin-bottom: 2px; }
    </style>
</head>
<body>

    <div id="app-frame">
        <header>
            <i class="fas fa-arrow-left back-btn" id="backBtn" onclick="goBack()"></i>
            <div class="header-title" id="headerTitle">ReciclaLogo</div>
        </header>

        <main id="main-content">
            <div id="screen-home" class="screen active">
                <p class="instruction-text">Selecione para aprender e descartar</p>
                <div class="grid">
                    <div class="card bg-blue" onclick="openDetails('Papel', '#1976D2', 'fa-file-alt')"><i class="fas fa-file-alt"></i><span>Papel</span></div>
                    <div class="card bg-red" onclick="openDetails('Plástico', '#D32F2F', 'fa-wine-bottle')"><i class="fas fa-wine-bottle"></i><span>Plástico</span></div>
                    <div class="card bg-yellow" onclick="openDetails('Metal', '#FBC02D', 'fa-beer')"><i class="fas fa-beer"></i><span>Metal</span></div>
                    <div class="card bg-green" onclick="openDetails('Vidro', '#388E3C', 'fa-wine-glass')"><i class="fas fa-wine-glass"></i><span>Vidro</span></div>
                    <div class="card bg-gray" onclick="openDetails('Eletrônicos', '#616161', 'fa-desktop')"><i class="fas fa-desktop"></i><span>Eletrônicos</span></div>
                    <div class="card bg-orange" onclick="openDetails('Pilhas', '#F57C00', 'fa-battery-full')"><i class="fas fa-battery-full"></i><span>Pilhas</span></div>
                    <div class="card bg-brown" onclick="openDetails('Óleo Vegetal', '#E64A19', 'fa-tint')"><i class="fas fa-tint"></i><span>Óleo</span></div>
                    <div class="card bg-dark" onclick="openDetails('Lixo Comum', '#455A64', 'fa-trash')"><i class="fas fa-trash"></i><span>Lixo Comum</span></div>
                </div>
            </div>

            <div id="screen-details" class="screen">
                <div class="scrollable-content" id="detail-content"></div>
                <button class="btn-action" style="background-color: #F57C00; margin-top: 10px;" onclick="openCollectScreen()">
                    <i class="fas fa-camera"></i> REGISTRAR DESCARTE
                </button>
            </div>
            
            <div id="screen-collect" class="screen">
                <div class="scrollable-content">
                    <h2 style="color: var(--primary); margin-bottom: 10px;">Novo Registro</h2>
                    <p>Material: <strong id="collect-material-name">---</strong></p>
                    <input id="empresa" class="form-input" placeholder="Local / Empresa">
                    <input id="quantidade" type="number" class="form-input" placeholder="Quantidade (kg)">
                    <input id="camera" type="file" accept="image/*" capture="environment" style="display:none">
                    <button class="btn-action" style="background:#666; margin-top:15px" onclick="document.getElementById('camera').click()"><i class="fas fa-camera"></i> FOTO</button>
                    <img id="preview" style="width:100%; margin-top:10px; display:none; border-radius:8px;">
                </div>
                <button class="btn-action" onclick="salvarColeta()">SALVAR</button>
            </div>

            <div id="screen-routes" class="screen">
                <div class="map-container">
                    
                    <div class="search-bar-container">
                        <input type="text" placeholder="Digite o endereço desejado">
                        <i class="fas fa-search" style="color: #666;"></i>
                    </div>

                    <div class="toggle-container">
                        <div class="toggle-btn toggle-active">ROTAS</div>
                        <div class="toggle-btn toggle-inactive">ECOPONTOS</div>
                    </div>

                    <i class="fas fa-map-marker-alt map-pin"></i>

                    <div class="bottom-card-overlay">
                        <p class="bottom-card-text">
                            Sua localização não está na rota de coleta ou próxima a um ecoponto.
                        </p>
                        <button class="bottom-card-btn" onclick="alert('Buscando rotas alternativas...')">
                            BUSCAR MEUS RECICLÁVEIS
                        </button>
                    </div>

                </div>
            </div>

            <div id="screen-reports" class="screen">
                <h2 style="color: var(--primary);">Relatórios</h2>
                <div style="background:white; padding:10px; border-radius:8px; margin:15px 0;"><canvas id="barChart"></canvas></div>
                <div id="listaColetas" class="scrollable-content"><p style="text-align:center">Carregando...</p></div>
            </div>

            <div id="screen-contact" class="screen">
                <h2 style="color: var(--primary);">Contato</h2>
                <input class="form-input" placeholder="Nome"><textarea class="form-input" style="height:120px" placeholder="Mensagem"></textarea>
                <button class="btn-action" onclick="alert('Enviado!')">ENVIAR</button>
            </div>
        </main>

        <nav class="bottom-nav">
            <div class="nav-item active" id="nav-home" onclick="navigate('home')"><i class="fas fa-recycle"></i><span>Materiais</span></div>
            <div class="nav-item" id="nav-routes" onclick="navigate('routes')"><i class="fas fa-truck"></i><span>Coleta</span></div>
            <div class="nav-item" id="nav-reports" onclick="navigate('reports'); carregarPainel();"><i class="fas fa-chart-pie"></i><span>Relatórios</span></div>
            <div class="nav-item" id="nav-contact" onclick="navigate('contact')"><i class="fas fa-envelope"></i><span>Contato</span></div>
        </nav>
    </div>

    <script>
        const SUPABASE_URL = "https://zmshzpogevuzoxlhqfeb.supabase.co";
        const SUPABASE_KEY = "sb_publishable_AiuJM7hYrKqZRxn_JWYWgA_s_VdqLgt"; 
        let materialSelecionado = "", fotoBase64 = "";

        const materialsData = {
            'Papel': {recyclable:['Jornais','Caixas'], nonRecyclable:['Papel Higiênico'], disposal:'Limpo e seco.'},
            'Plástico': {recyclable:['PET','Copos'], nonRecyclable:['Cabo panela'], disposal:'Lavar antes.'},
            'Metal': {recyclable:['Latas'], nonRecyclable:['Esponja aço'], disposal:'Amassar latas.'},
            'Vidro': {recyclable:['Garrafas'], nonRecyclable:['Espelhos'], disposal:'Cuidado ao quebrar.'},
            'Eletrônicos': {recyclable:['Celulares'], nonRecyclable:['Lâmpadas'], disposal:'Ecoponto específico.'},
            'Pilhas': {recyclable:['Baterias'], nonRecyclable:['Vazando'], disposal:'Isolar polos.'},
            'Óleo Vegetal': {recyclable:['Óleo fritura'], nonRecyclable:['Misturado'], disposal:'Garrafa PET.'},
            'Lixo Comum': {recyclable:[], nonRecyclable:['Tudo'], disposal:'Aterro sanitário.'}
        };

        function navigate(screenId) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('screen-' + screenId).classList.add('active');
            
            const navBtn = document.getElementById('nav-' + screenId);
            if(navBtn) navBtn.classList.add('active');

            const headerTitle = document.getElementById('headerTitle');
            const backBtn = document.getElementById('backBtn');
            const mainContent = document.getElementById('main-content');
            
            if(screenId === 'routes') mainContent.classList.add('no-padding');
            else mainContent.classList.remove('no-padding');

            if(screenId === 'home') { headerTitle.innerText = 'ReciclaLogo'; backBtn.style.display = 'none'; } 
            else { 
                backBtn.style.display = 'block'; 
                const titles = { routes: 'Rotas', reports: 'Relatórios', contact: 'Contato', details: 'Detalhes', collect: 'Registro' };
                if(titles[screenId]) headerTitle.innerText = titles[screenId];
            }
        }
        function goBack() { navigate('home'); }

        function openDetails(type, color, icon) {
            materialSelecionado = type;
            const data = materialsData[type];
            const contentDiv = document.getElementById('detail-content');
            contentDiv.innerHTML = `
                <div style="background:${color}; color:white; padding:20px; border-radius:12px; text-align:center; margin-bottom:15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                    <i class="${icon} fa-3x"></i><h2 style="margin-top:10px">${type}</h2>
                </div>
                <div style="background:white; padding:15px; border-radius:12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <h3 style="color:${color}; border-bottom:1px solid #eee; padding-bottom:5px">✅ O que pode</h3><p style="margin:8px 0">${data.recyclable.join(', ') || 'Nenhum'}</p>
                    <h3 style="color:red; margin-top:15px; border-bottom:1px solid #eee; padding-bottom:5px">❌ O que não pode</h3><p style="margin:8px 0">${data.nonRecyclable.join(', ')}</p>
                    <h3 style="margin-top:15px; border-bottom:1px solid #eee; padding-bottom:5px">ℹ️ Como descartar</h3><p style="margin:8px 0">${data.disposal}</p>
                </div>
            `;
            navigate('details');
        }

        function openCollectScreen() {
            document.getElementById('collect-material-name').innerText = materialSelecionado;
            navigate('collect');
        }

        document.getElementById("camera").addEventListener("change", function(e){
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(){
                fotoBase64 = reader.result;
                const img = document.getElementById("preview");
                img.src = fotoBase64; img.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        async function salvarColeta(){
            const empresa = document.getElementById("empresa").value;
            const quantidade = document.getElementById("quantidade").value;
            if(!empresa || !quantidade){ alert("Preencha todos os campos!"); return; }
            const btn = document.querySelector('#screen-collect button:last-child');
            btn.innerHTML = 'Salvando...';
            
            // Simulação de delay de rede
            setTimeout(() => {
                alert("Coleta registrada com sucesso!"); 
                btn.innerHTML = 'SALVAR';
                navigate('reports'); 
                carregarPainel();
            }, 1000);
        }

        function carregarPainel(){
             // Simulação de carregamento
             document.getElementById("listaColetas").innerHTML = "<div style='background:white; padding:10px; border-radius:8px; border-left:4px solid green; margin-bottom:8px; box-shadow:0 1px 3px rgba(0,0,0,0.1)'><strong>Papel</strong><br>5kg - Empresa Local<br><small style='color:#888'>Hoje, 14:30</small></div>";
             setTimeout(() => {
                new Chart(document.getElementById('barChart'), {
                    type: 'bar',
                    data: { labels: ['Papel','Vidro', 'Plástico'], datasets: [{ label: 'Kg coletados', data: [15, 8, 22], backgroundColor: ['#1976D2', '#388E3C', '#D32F2F'] }] },
                    options: { responsive: true, plugins: { legend: { display: false } } }
                });
             }, 100);
        }
    </script>
</body>
</html>
