<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ReciclaLogo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #2e7d32;
            --bg: #F5F5F5;
            --text: #333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: Roboto, Helvetica, Arial, sans-serif; }
        
        /* CORREÇÃO PARA CELULAR (DVH) */
        body { 
            background-color: #333; 
            display: flex; 
            justify-content: center; 
            height: 100vh;
            height: 100dvh; 
            overflow: hidden; 
            margin: 0;
        }

        #app-frame {
            width: 100%; 
            height: 100%;
            background-color: var(--bg);
            display: flex; 
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        @media (min-width: 500px) {
            #app-frame { max-width: 412px; }
        }

        /* --- HEADER --- */
        header {
            background-color: var(--primary); 
            color: white; 
            height: 56px; 
            display: flex;
            align-items: center; 
            justify-content: center;
            flex-shrink: 0; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .header-title { font-size: 19px; font-weight: 600; }
        .back-btn { position: absolute; left: 16px; color: white; cursor: pointer; font-size: 20px; display: none; }

        /* --- MAIN --- */
        main { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            padding: 10px 12px; 
            padding-bottom: 70px; /* Espaço para menu */
            overflow-y: auto; 
            position: relative;
        }
        main.no-padding { padding: 0; padding-bottom: 60px; }

        .screen { display: none; height: 100%; width: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        .instruction-text {
            text-align: center; color: #666; font-size: 13px; margin-bottom: 8px; flex-shrink: 0;
        }

        /* --- GRID --- */
        .grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            grid-template-rows: repeat(4, 1fr); 
            gap: 10px; 
            flex: 1; 
            min-height: 0;
        }
        
        .card {
            border-radius: 12px;
            color: white;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            width: 100%; height: 100%; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            cursor: pointer; 
            position: relative;
        }
        .card:active { transform: scale(0.98); opacity: 0.9; }
        .card i { font-size: 32px; margin-bottom: 5px; }
        .card span { font-weight: bold; font-size: 13px; text-transform: uppercase; }

        /* Cores */
        .bg-blue { background-color: #1976D2; }
        .bg-red { background-color: #D32F2F; }
        .bg-yellow { background-color: #FBC02D; }
        .bg-green { background-color: #388E3C; }
        .bg-gray { background-color: #616161; }
        .bg-orange { background-color: #F57C00; }
        .bg-brown { background-color: #E64A19; }
        .bg-dark { background-color: #455A64; }

        /* --- ESTILOS DO RELATÓRIO --- */
        .report-item {
            background: white;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary);
            display: flex;
            flex-direction: column;
        }
        .report-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .report-img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 8px;
            border: 1px solid #eee;
        }

        /* --- MAPA E GPS --- */
        .map-container {
            width: 100%; height: 100%; position: relative;
            background-color: #e5e3df;
            display: flex; flex-direction: column;
        }
        .map-frame { border:0; width:100%; height:100%; opacity: 0.7; }

        .search-bar-container {
            position: absolute; top: 15px; left: 15px; right: 15px;
            background: white; border-radius: 4px; padding: 0 15px; height: 48px;
            display: flex; align-items: center; box-shadow: 0 2px 6px rgba(0,0,0,0.3); z-index: 2;
        }
        .search-bar-container input { border: none; outline: none; flex: 1; font-size: 16px; margin-left: 10px; }

        .toggle-container {
            position: absolute; top: 75px; left: 15px; right: 15px;
            display: flex; gap: 10px; z-index: 2;
        }
        .toggle-btn {
            flex: 1; padding: 10px; border-radius: 25px; text-align: center;
            font-weight: bold; font-size: 13px; color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        .toggle-active { background-color: #1b5e20; }
        .toggle-inactive { background-color: #757575; }

        .bottom-card-overlay {
            position: absolute; bottom: 20px; left: 15px; right: 15px;
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2); z-index: 2; text-align: center;
        }
        .bottom-card-text { font-size: 14px; color: #444; margin-bottom: 15px; line-height: 1.4; }
        
        .gps-button {
            background-color: #1976D2; 
            color: white; text-align: center;
            padding: 12px; border-radius: 25px; font-weight: bold; font-size: 14px;
            text-transform: uppercase; width: 100%; border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .gps-status { font-size: 12px; color: #666; margin-top: 8px; font-style: italic; }

        /* GERAIS */
        .scrollable-content { overflow-y: auto; flex: 1; padding: 5px; }
        .btn-action {
            background-color: var(--primary); color: white; border: none; padding: 15px;
            border-radius: 8px; font-size: 16px; margin-top: auto; width: 100%;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold;
        }
        .form-input { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
        
        /* --- MENU FIXO --- */
        nav.bottom-nav {
            background: white; 
            border-top: 1px solid #ddd; 
            display: flex; 
            justify-content: space-around; 
            align-items: center;
            position: absolute; bottom: 0; left: 0; width: 100%;
            height: 60px; 
            z-index: 999;
            padding-bottom: env(safe-area-inset-bottom); 
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #757575; font-size: 10px; cursor: pointer; width: 25%; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 24px; margin-bottom: 2px; }
    </style>
</head>
<body>

    <div id="app-frame">
        <header>
            <i class="fas fa-arrow-left back-btn" id="backBtn" onclick="goBack()"></i>
            <div class="header-title" id="headerTitle">ReciclaLogo</div>
        </header>

        <main id="main-content">
            <div id="screen-home" class="screen active">
                <p class="instruction-text">Selecione para aprender e descartar</p>
                <div class="grid">
                    <div class="card bg-blue" onclick="openDetails('Papel', '#1976D2', 'fa-file-alt')"><i class="fas fa-file-alt"></i><span>Papel</span></div>
                    <div class="card bg-red" onclick="openDetails('Plástico', '#D32F2F', 'fa-wine-bottle')"><i class="fas fa-wine-bottle"></i><span>Plástico</span></div>
                    <div class="card bg-yellow" onclick="openDetails('Metal', '#FBC02D', 'fa-beer')"><i class="fas fa-beer"></i><span>Metal</span></div>
                    <div class="card bg-green" onclick="openDetails('Vidro', '#388E3C', 'fa-wine-glass')"><i class="fas fa-wine-glass"></i><span>Vidro</span></div>
                    <div class="card bg-gray" onclick="openDetails('Eletrônicos', '#616161', 'fa-desktop')"><i class="fas fa-desktop"></i><span>Eletrônicos</span></div>
                    <div class="card bg-orange" onclick="openDetails('Pilhas', '#F57C00', 'fa-battery-full')"><i class="fas fa-battery-full"></i><span>Pilhas</span></div>
                    <div class="card bg-brown" onclick="openDetails('Óleo Vegetal', '#E64A19', 'fa-tint')"><i class="fas fa-tint"></i><span>Óleo</span></div>
                    <div class="card bg-dark" onclick="openDetails('Lixo Comum', '#455A64', 'fa-trash')"><i class="fas fa-trash"></i><span>Lixo Comum</span></div>
                </div>
            </div>

            <div id="screen-details" class="screen">
                <div class="scrollable-content" id="detail-content"></div>
                <button class="btn-action" style="background-color: #F57C00; margin-top: 10px;" onclick="openCollectScreen()">
                    <i class="fas fa-camera"></i> REGISTRAR DESCARTE
                </button>
            </div>
            
            <div id="screen-collect" class="screen">
                <div class="scrollable-content">
                    <h2 style="color: var(--primary); margin-bottom: 10px;">Novo Registro</h2>
                    <p>Material: <strong id="collect-material-name">---</strong></p>
                    <input id="empresa" class="form-input" placeholder="Local / Empresa">
                    <input id="quantidade" type="number" class="form-input" placeholder="Quantidade (kg)">
                    
                    <input id="camera" type="file" accept="image/*" capture="environment" style="display:none">
                    
                    <button class="btn-action" style="background:#666; margin-top:15px" onclick="document.getElementById('camera').click()">
                        <i class="fas fa-camera"></i> TIRAR FOTO
                    </button>
                    
                    <img id="preview" style="width:100%; margin-top:10px; display:none; border-radius:8px; border: 2px dashed #ccc; min-height: 150px; object-fit: cover;">
                </div>
                <button class="btn-action" onclick="salvarColeta()">SALVAR</button>
            </div>

            <div id="screen-routes" class="screen">
                <div class="map-container">
                    <iframe id="mapa-frame" class="map-frame" src="https://maps.google.com/maps?q=-23.550520,-46.633308&z=12&output=embed" allowfullscreen="" loading="lazy"></iframe>
                    <div class="search-bar-container"><input type="text" placeholder="Endereço desejado"><i class="fas fa-search" style="color: #666;"></i></div>
                    <div class="toggle-container"><div class="toggle-btn toggle-active">ROTAS</div><div class="toggle-btn toggle-inactive">ECOPONTOS</div></div>
                    <div class="bottom-card-overlay">
                        <p class="bottom-card-text">Deseja ver sua localização atual no mapa?</p>
                        <button class="gps-button" onclick="buscarLocalizacaoReal()">
                            <i class="fas fa-location-arrow"></i> MINHA LOCALIZAÇÃO
                        </button>
                        <div id="gps-status" class="gps-status"></div>
                    </div>
                </div>
            </div>

            <div id="screen-reports" class="screen">
                <h2 style="color: var(--primary);">Relatórios</h2>
                <div style="background:white; padding:10px; border-radius:8px; margin:15px 0;"><canvas id="barChart"></canvas></div>
                
                <div id="listaColetas" class="scrollable-content">
                    <p style="text-align:center; color: #666; margin-top: 20px;">Nenhum registro ainda.</p>
                </div>
            </div>

            <div id="screen-contact" class="screen">
                <h2 style="color: var(--primary);">Contato</h2>
                <input class="form-input" placeholder="Nome"><textarea class="form-input" style="height:120px" placeholder="Mensagem"></textarea>
                <button class="btn-action" onclick="alert('Enviado!')">ENVIAR</button>
            </div>
        </main>

        <nav class="bottom-nav">
            <div class="nav-item active" id="nav-home" onclick="navigate('home')"><i class="fas fa-recycle"></i><span>Materiais</span></div>
            <div class="nav-item" id="nav-routes" onclick="navigate('routes')"><i class="fas fa-truck"></i><span>Coleta</span></div>
            <div class="nav-item" id="nav-reports" onclick="navigate('reports'); carregarPainel();"><i class="fas fa-chart-pie"></i><span>Relatórios</span></div>
            <div class="nav-item" id="nav-contact" onclick="navigate('contact')"><i class="fas fa-envelope"></i><span>Contato</span></div>
        </nav>
    </div>

    <script>
        // LISTA GLOBAL PARA GUARDAR AS COLETAS (Memória temporária)
        let globalColetas = [];
        let materialSelecionado = "";
        let fotoBase64 = "";

        const materialsData = {
            'Papel': {recyclable:['Jornais','Caixas'], nonRecyclable:['Papel Higiênico'], disposal:'Limpo e seco.'},
            'Plástico': {recyclable:['PET','Copos'], nonRecyclable:['Cabo panela'], disposal:'Lavar antes.'},
            'Metal': {recyclable:['Latas'], nonRecyclable:['Esponja aço'], disposal:'Amassar latas.'},
            'Vidro': {recyclable:['Garrafas'], nonRecyclable:['Espelhos'], disposal:'Cuidado ao quebrar.'},
            'Eletrônicos': {recyclable:['Celulares'], nonRecyclable:['Lâmpadas'], disposal:'Ecoponto específico.'},
            'Pilhas': {recyclable:['Baterias'], nonRecyclable:['Vazando'], disposal:'Isolar polos.'},
            'Óleo Vegetal': {recyclable:['Óleo fritura'], nonRecyclable:['Misturado'], disposal:'Garrafa PET.'},
            'Lixo Comum': {recyclable:[], nonRecyclable:['Tudo'], disposal:'Aterro sanitário.'}
        };

        function navigate(screenId) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('screen-' + screenId).classList.add('active');
            
            const navBtn = document.getElementById('nav-' + screenId);
            if(navBtn) navBtn.classList.add('active');

            const headerTitle = document.getElementById('headerTitle');
            const backBtn = document.getElementById('backBtn');
            const mainContent = document.getElementById('main-content');
            
            if(screenId === 'routes') mainContent.classList.add('no-padding');
            else mainContent.classList.remove('no-padding');

            if(screenId === 'home') { headerTitle.innerText = 'ReciclaLogo'; backBtn.style.display = 'none'; } 
            else { 
                backBtn.style.display = 'block'; 
                const titles = { routes: 'Rotas', reports: 'Relatórios', contact: 'Contato', details: 'Detalhes', collect: 'Registro' };
                if(titles[screenId]) headerTitle.innerText = titles[screenId];
            }
        }
        function goBack() { navigate('home'); }

        function openDetails(type, color, icon) {
            materialSelecionado = type;
            const data = materialsData[type];
            const contentDiv = document.getElementById('detail-content');
            contentDiv.innerHTML = `
                <div style="background:${color}; color:white; padding:20px; border-radius:12px; text-align:center; margin-bottom:15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                    <i class="${icon} fa-3x"></i><h2 style="margin-top:10px">${type}</h2>
                </div>
                <div style="background:white; padding:15px; border-radius:12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <h3 style="color:${color}; border-bottom:1px solid #eee; padding-bottom:5px">✅ O que pode</h3><p style="margin:8px 0">${data.recyclable.join(', ') || 'Nenhum'}</p>
                    <h3 style="color:red; margin-top:15px; border-bottom:1px solid #eee; padding-bottom:5px">❌ O que não pode</h3><p style="margin:8px 0">${data.nonRecyclable.join(', ')}</p>
                    <h3 style="margin-top:15px; border-bottom:1px solid #eee; padding-bottom:5px">ℹ️ Como descartar</h3><p style="margin:8px 0">${data.disposal}</p>
                </div>
            `;
            navigate('details');
        }

        function openCollectScreen() {
            document.getElementById('collect-material-name').innerText = materialSelecionado;
            // Limpar campos
            document.getElementById("empresa").value = "";
            document.getElementById("quantidade").value = "";
            document.getElementById("preview").style.display = 'none';
            document.getElementById("preview").src = "";
            fotoBase64 = ""; // Resetar foto
            navigate('collect');
        }

        /* GPS REAL */
        function buscarLocalizacaoReal() {
            const statusDiv = document.getElementById("gps-status");
            const mapaFrame = document.getElementById("mapa-frame");
            if (!navigator.geolocation) { statusDiv.innerHTML = "GPS não suportado."; return; }
            statusDiv.innerHTML = "Buscando satélites...";
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const long = position.coords.longitude;
                    statusDiv.innerHTML = "Localização atualizada!";
                    mapaFrame.src = `https://maps.google.com/maps?q=${lat},${long}&z=15&output=embed`;
                },
                (error) => { statusDiv.innerHTML = "Erro GPS."; console.error(error); }
            );
        }

        // --- CÂMERA E PREVIEW ---
        document.getElementById("camera").addEventListener("change", function(e){
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(){
                fotoBase64 = reader.result; // Guarda a foto em base64
                const img = document.getElementById("preview");
                img.src = fotoBase64; 
                img.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        // --- SALVAR NA LISTA (MEMÓRIA) ---
        function salvarColeta(){
            const empresa = document.getElementById("empresa").value;
            const quantidade = document.getElementById("quantidade").value;
            
            if(!empresa || !quantidade){ alert("Preencha todos os campos!"); return; }

            // Cria o objeto da coleta
            const novaColeta = {
                material: materialSelecionado,
                empresa: empresa,
                qtd: quantidade,
                foto: fotoBase64, // Aqui vai a foto!
                data: new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})
            };

            // Adiciona no início da lista global
            globalColetas.unshift(novaColeta);

            const btn = document.querySelector('#screen-collect button:last-child');
            btn.innerHTML = 'Salvando...';
            
            setTimeout(() => {
                alert("Coleta registrada!"); 
                btn.innerHTML = 'SALVAR';
                navigate('reports'); 
                carregarPainel(); // Atualiza a tela de relatórios
            }, 800);
        }

        // --- CARREGAR RELATÓRIOS (COM FOTO) ---
        function carregarPainel(){
             const container = document.getElementById("listaColetas");
             container.innerHTML = ""; // Limpa a lista

             if (globalColetas.length === 0) {
                 container.innerHTML = '<p style="text-align:center; color:#666; margin-top:20px;">Nenhum registro ainda.</p>';
                 return;
             }

             // Percorre a lista e cria os cards
             globalColetas.forEach(item => {
                 // Verifica se tem foto para mostrar
                 const imgHtml = item.foto ? `<img src="${item.foto}" class="report-img">` : '';

                 const cardHtml = `
                    <div class="report-item">
                        <div class="report-header">
                            <strong>${item.material}</strong>
                            <small style="color:#666">${item.data}</small>
                        </div>
                        <div style="font-size:14px; color:#444">
                            ${item.qtd}kg • ${item.empresa}
                        </div>
                        ${imgHtml}
                    </div>
                 `;
                 container.innerHTML += cardHtml;
             });

             // Atualiza Gráfico (Simples)
             // (Em um app real, somaria os valores de 'globalColetas')
             new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: { labels: ['Papel','Vidro', 'Plástico'], datasets: [{ label: 'Kg', data: [15, 8, 22], backgroundColor: ['#1976D2', '#388E3C', '#D32F2F'] }] },
                options: { responsive: true, plugins: { legend: { display: false } } }
             });
        }
    </script>
</body>
</html>
